/*
  **  iFrameX - Created by Matias Lopez for Videskâ„¢
  **  Iframe generator for append elements without limitations
  **  for modern browsers.
  **  
  **  MIT License for Commercial or non commercial use
*/
const iFrameX=class{constructor({attr,content,append,config}){this.attr=attr||{};this.content=content||[];this.body=document.querySelector(append)||document.querySelector('body');this.id=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);this.events=[];this.iframe=null;this.debug=config.debug||!1;this.action=(typeof config.action==='function')?config.action:function(msg){}};init(){this._createIframe((iframe)=>{if(iframe){this._addElements(this.content)}})};_createIframe(callback){if(!this.iframe){let iframe=document.createElement('iframe');iframe.setAttribute('iframe-id',this.id);const attr=Object.keys(this.attr);if(attr.length>0){attr.map((i)=>{iframe.setAttribute(i,this.attr[i])})}
this.body.appendChild(iframe);this.iframe=document.querySelector(`[iframe-id="${this.id}"]`);this._addEventListener();(typeof callback==='function')&&callback(iframe)}else{console.error('An iframe already exists, please instance a new iFrameX. Read docs here: https://github.com/matiaslopezd/iframex');(typeof callback==='function')&&callback(null)}};_addElements(elements){function _createAndBind(i){const el=document.createElement(i.type);if(i.content!==''){el.innerHTML=i.content};(i.attr)&&Object.keys(i.attr).map((a)=>{el.setAttribute(a,i.attr[a])});return el}
if(Array.isArray(elements)&&elements.length>0){elements.map((obj)=>{this.iframe.contentWindow.document.querySelector(obj.append||'body').appendChild(_createAndBind(obj))})}else if(typeof elements==='object'){this.iframe.contentWindow.document.querySelector(elements.append||'body').appendChild(_createAndBind(elements))}};_addEventListener(){this._addElements({type:'script',content:this._bindEvent('window',`'message'`,this.action)})};_bindEvent(element,eventName,eventHandler){let event=null;element=(element==='window')?element:`document.querySelector(${element})`;if(window.addEventListener){event=`${element}.addEventListener(${eventName}, ${eventHandler}, false);`}else if(window.attachEvent){event=`${element}.attachEvent(on${eventName}, ${eventHandler});`}
return event}}